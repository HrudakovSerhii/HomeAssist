{
  "openapi": "3.0.0",
  "info": {
    "title": "HomeAssist API",
    "version": "1.0.0",
    "description": "API for HomeAssist email processing and management system"
  },
  "servers": [
    {
      "url": "http://localhost:4000/api",
      "description": "Development server"
    }
  ],
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email",
            "nullable": true
          },
          "displayName": {
            "type": "string"
          },
          "profilePicture": {
            "type": "string",
            "nullable": true
          },
          "isActive": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "lastLoginAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["id", "username", "displayName", "isActive", "createdAt", "updatedAt", "lastLoginAt"]
      },
      "CreateUserDto": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string"
          },
          "password": {
            "type": "string",
            "minLength": 6
          },
          "displayName": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          }
        },
        "required": ["username", "password", "displayName"]
      },
      "LoginDto": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        },
        "required": ["username", "password"]
      },
      "AuthResponse": {
        "type": "object",
        "properties": {
          "user": {
            "$ref": "#/components/schemas/User"
          },
          "token": {
            "type": "string"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["user", "token", "expiresAt"]
      },
      "AddEmailAccountDto": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "format": "uuid"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "appPassword": {
            "type": "string"
          },
          "displayName": {
            "type": "string"
          },
          "accountType": {
            "type": "string",
            "enum": ["GMAIL", "OUTLOOK", "YAHOO", "IMAP_GENERIC"]
          }
        },
        "required": ["userId", "email", "appPassword"]
      },
      "TestImapDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "appPassword": {
            "type": "string"
          },
          "accountType": {
            "type": "string",
            "enum": ["GMAIL", "OUTLOOK", "YAHOO", "IMAP_GENERIC"]
          }
        },
        "required": ["email", "appPassword"]
      },
      "ImapTestResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "message": {
            "type": "string"
          }
        },
        "required": ["success", "message"]
      },
      "EmailCategory": {
        "type": "string",
        "enum": ["WORK", "PERSONAL", "FINANCE", "HEALTH", "BILLS", "RECEIPTS", "INVOICES", "STATEMENTS", "CONTRACTS", "OTHER"]
      },
      "Priority": {
        "type": "string",
        "enum": ["LOW", "MEDIUM", "HIGH", "URGENT"]
      },
      "Sentiment": {
        "type": "string",
        "enum": ["POSITIVE", "NEUTRAL", "NEGATIVE"]
      },
      "EntityType": {
        "type": "string",
        "enum": ["DATE", "PERSON", "ORGANIZATION", "PRODUCT", "LOCATION", "TIME", "EVENT", "MONEY", "PHONE", "EMAIL"]
      },
      "ActionType": {
        "type": "string",
        "enum": ["MEETING", "TASK", "FOLLOW_UP", "REVIEW", "NOTIFICATION", "TRACKING", "PREPARATION", "PAYMENT", "REMINDER"]
      },
      "EntityExtraction": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "entityType": {
            "$ref": "#/components/schemas/EntityType"
          },
          "entityValue": {
            "type": "string"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "startPosition": {
            "type": "integer",
            "nullable": true
          },
          "endPosition": {
            "type": "integer",
            "nullable": true
          },
          "context": {
            "type": "string",
            "nullable": true
          }
        },
        "required": ["id", "entityType", "entityValue", "confidence"]
      },
      "ActionItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "description": {
            "type": "string"
          },
          "actionType": {
            "$ref": "#/components/schemas/ActionType"
          },
          "dueDate": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "priority": {
            "$ref": "#/components/schemas/Priority"
          },
          "isCompleted": {
            "type": "boolean"
          },
          "completedAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "assignedTo": {
            "type": "string",
            "nullable": true
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["id", "description", "actionType", "priority", "isCompleted", "createdAt", "updatedAt"]
      },
      "Email": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "messageId": {
            "type": "string"
          },
          "subject": {
            "type": "string"
          },
          "fromAddress": {
            "type": "string",
            "format": "email"
          },
          "toAddresses": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "email"
            }
          },
          "ccAddresses": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "email"
            }
          },
          "bccAddresses": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "email"
            }
          },
          "receivedAt": {
            "type": "string",
            "format": "date-time"
          },
          "bodyText": {
            "type": "string",
            "nullable": true
          },
          "bodyHtml": {
            "type": "string",
            "nullable": true
          },
          "isProcessed": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": ["id", "messageId", "subject", "fromAddress", "toAddresses", "receivedAt", "isProcessed", "createdAt", "updatedAt"]
      },
      "ExtractedEmailData": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "emailId": {
            "type": "string",
            "format": "uuid"
          },
          "category": {
            "$ref": "#/components/schemas/EmailCategory"
          },
          "priority": {
            "$ref": "#/components/schemas/Priority"
          },
          "sentiment": {
            "$ref": "#/components/schemas/Sentiment"
          },
          "summary": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "email": {
            "$ref": "#/components/schemas/Email"
          },
          "entities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EntityExtraction"
            }
          },
          "actionItems": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ActionItem"
            }
          }
        },
        "required": ["id", "emailId", "category", "priority", "sentiment", "summary", "tags", "confidence", "createdAt", "updatedAt", "email", "entities", "actionItems"]
      },
      "ExtractedDataQueryDto": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "minimum": 1,
            "default": 1
          },
          "limit": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 10
          },
          "search": {
            "type": "string"
          },
          "category": {
            "$ref": "#/components/schemas/EmailCategory"
          },
          "priority": {
            "$ref": "#/components/schemas/Priority"
          },
          "sentiment": {
            "$ref": "#/components/schemas/Sentiment"
          },
          "entityType": {
            "$ref": "#/components/schemas/EntityType"
          },
          "actionType": {
            "$ref": "#/components/schemas/ActionType"
          },
          "dateFrom": {
            "type": "string",
            "format": "date"
          },
          "dateTo": {
            "type": "string",
            "format": "date"
          },
          "minConfidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "sortBy": {
            "type": "string",
            "enum": ["createdAt", "updatedAt", "confidence", "receivedAt"],
            "default": "createdAt"
          },
          "sortOrder": {
            "type": "string",
            "enum": ["asc", "desc"],
            "default": "desc"
          }
        }
      },
      "Pagination": {
        "type": "object",
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "page": {
            "type": "integer",
            "minimum": 1
          },
          "limit": {
            "type": "integer",
            "minimum": 1
          },
          "totalPages": {
            "type": "integer",
            "minimum": 0
          }
        },
        "required": ["total", "page", "limit", "totalPages"]
      },
      "ExtractedDataResponse": {
        "type": "object",
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ExtractedEmailData"
            }
          },
          "pagination": {
            "$ref": "#/components/schemas/Pagination"
          }
        },
        "required": ["data", "pagination"]
      },
      "FilterOptions": {
        "type": "object",
        "properties": {
          "categories": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EmailCategory"
            }
          },
          "priorities": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Priority"
            }
          },
          "sentiments": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Sentiment"
            }
          },
          "entityTypes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/EntityType"
            }
          },
          "actionTypes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ActionType"
            }
          }
        },
        "required": ["categories", "priorities", "sentiments", "entityTypes", "actionTypes"]
      },
      "UpdateActionItemDto": {
        "type": "object",
        "properties": {
          "isCompleted": {
            "type": "boolean"
          }
        },
        "required": ["isCompleted"]
      },
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["ok"]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "environment": {
            "type": "string"
          },
          "version": {
            "type": "string"
          },
          "apiPrefix": {
            "type": "string"
          }
        },
        "required": ["status", "timestamp", "environment", "version", "apiPrefix"]
      },
      "LLMExecuteDto": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string",
            "minLength": 1,
            "maxLength": 2000
          },
          "llmModel": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50
          },
          "target": {
            "type": "string",
            "enum": ["local", "remote"],
            "default": "local"
          },
          "options": {
            "type": "object",
            "additionalProperties": true
          },
          "history": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "role": {
                  "type": "string"
                },
                "content": {
                  "type": "string"
                }
              },
              "required": ["role", "content"]
            }
          }
        },
        "required": ["prompt", "llmModel"]
      },
      "LLMResponse": {
        "type": "object",
        "properties": {
          "model": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "response": {
            "type": "string"
          },
          "raw": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "required": ["model", "createdAt", "response", "raw"]
      },
      "AppResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          }
        },
        "required": ["message"]
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "statusCode": {
            "type": "integer"
          },
          "message": {
            "type": "string"
          },
          "error": {
            "type": "string"
          }
        },
        "required": ["statusCode", "message"]
      }
    }
  },
  "paths": {
    "/": {
      "get": {
        "tags": ["App"],
        "summary": "Get app status",
        "responses": {
          "200": {
            "description": "App status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AppResponse"
                }
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Get health status",
        "responses": {
          "200": {
            "description": "Health status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HealthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "Register a new user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "Login user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/add-account": {
      "post": {
        "tags": ["Auth"],
        "summary": "Add email account to user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddEmailAccountDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Email account added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "email": {
                      "type": "string",
                      "format": "email"
                    },
                    "accountType": {
                      "type": "string",
                      "enum": ["GMAIL", "OUTLOOK", "YAHOO", "IMAP_GENERIC"]
                    },
                    "isActive": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/test-imap": {
      "post": {
        "tags": ["Auth"],
        "summary": "Test IMAP connection",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TestImapDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "IMAP test result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ImapTestResponse"
                }
              }
            }
          }
        }
      }
    },
    "/data/extracted": {
      "get": {
        "tags": ["Data"],
        "summary": "Get extracted email data with filtering and pagination",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            }
          },
          {
            "name": "search",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "category",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/EmailCategory"
            }
          },
          {
            "name": "priority",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/Priority"
            }
          },
          {
            "name": "sentiment",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/Sentiment"
            }
          },
          {
            "name": "entityType",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/EntityType"
            }
          },
          {
            "name": "actionType",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/ActionType"
            }
          },
          {
            "name": "dateFrom",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "dateTo",
            "in": "query",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "minConfidence",
            "in": "query",
            "schema": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          },
          {
            "name": "sortBy",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["createdAt", "updatedAt", "confidence", "receivedAt"],
              "default": "createdAt"
            }
          },
          {
            "name": "sortOrder",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": ["asc", "desc"],
              "default": "desc"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Extracted email data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ExtractedDataResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/data/filter-options": {
      "get": {
        "tags": ["Data"],
        "summary": "Get available filter options",
        "responses": {
          "200": {
            "description": "Filter options",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FilterOptions"
                }
              }
            }
          }
        }
      }
    },
    "/data/emails/{emailId}/actions/{actionIndex}": {
      "patch": {
        "tags": ["Data"],
        "summary": "Update action item completion status",
        "parameters": [
          {
            "name": "emailId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "actionIndex",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 0
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateActionItemDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Action item updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ActionItem"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/llm/execute": {
      "post": {
        "tags": ["LLM"],
        "summary": "Execute LLM prompt",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LLMExecuteDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "LLM execution result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LLMResponse"
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "App",
      "description": "Application endpoints"
    },
    {
      "name": "Health",
      "description": "Health check endpoints"
    },
    {
      "name": "Auth",
      "description": "Authentication and authorization endpoints"
    },
    {
      "name": "Data",
      "description": "Email data processing endpoints"
    },
    {
      "name": "LLM",
      "description": "LLM processing endpoints"
    }
  ]
} 